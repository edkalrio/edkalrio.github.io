<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta name="robots" content="nofollow">
  <title>El DDNS de Cloudflare - Lunatic Geek</title>
  <meta property="og:title" content="El DDNS de Cloudflare - Lunatic Geek" />
  <meta name="twitter:title" content="El DDNS de Cloudflare - Lunatic Geek" />
  <meta name="description" content="Llevo reivindicando la creación de un servidor DDNS público por parte de Cloudflare desde hace más de cinco años, pero ese escenario me parece cada vez más improbable. Para ellos no sería más que un toy project que asignarían a un becario, como forma de promocionar su negocio serverless.
Por mi parte, estoy muy contento con el servidor que ofrece duckdns.org. Los uso desde que empecé a montar webs, y es el que recomiendo a todo el mundo.">
  <meta property="og:description" content="Llevo reivindicando la creación de un servidor DDNS público por parte de Cloudflare desde hace más de cinco años, pero ese escenario me parece cada vez más improbable. Para ellos no sería más que un toy project que asignarían a un becario, como forma de promocionar su negocio serverless.
Por mi parte, estoy muy contento con el servidor que ofrece duckdns.org. Los uso desde que empecé a montar webs, y es el que recomiendo a todo el mundo.">
  <meta name="twitter:description" content="Llevo reivindicando la creación de un servidor DDNS público por parte de Cloudflare desde hace más de cinco años, pero ese escenario me parece cada vez más improbable. Para ellos no sería más que un …">
  <meta name="author" content="edkalrio"/>
  <link rel="icon" type="image/png" href="https://lunaticgeek.com/favicon.png" />
  <meta property="og:site_name" content="Lunatic Geek" />
  <meta property="og:url" content="/ddns/" />
  <meta property="og:type" content="article" />
    <meta property="og:image" content="https://archives.bulbagarden.net/media/upload/2/24/Spr_2c_054.png" />
    <meta name="twitter:image" content="https://archives.bulbagarden.net/media/upload/2/24/Spr_2c_054.png" />
  
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="generator" content="WIT" />
  <meta http-equiv="onion-location" content="http://mdoovnnifyqyl6jmgdibrsbq6tpk22npjhntsjkwvh7syrxgepxdejad.onion/" />
  <link rel="stylesheet" href="/css/style.css" media="all" />
  <link rel="stylesheet" href="/css/syntax.css" media="all" />
  <link rel="stylesheet" href="/css/custom.css" media="all" />
  



</head>

<body>

<header class="site-header">
  <h1 class="site-title"><a href="/"><img src="/lunaticgeek.webp" alt="Lunatic Geek"></a></h1>
	
  <nav class="site-navi">
    <ul class="site-navi-items">
      <li class="site-navi-item-tags"><a href="/tags/" title="Tags">Tags</a></li>
      <li class="site-navi-item-archives"><a href="/archives/" title="Archivo">Archivo</a></li>
      <li class="site-navi-item-about"><a href="/about/" title="Yo">Yo</a></li>
    </ul>
  </nav>
</header>
<hr class="site-header-bottom">


	<div class="main" role="main">
		<article class="article" vocab="https://schema.org/" typeof="BlogPosting">
			
			<meta property="image" content="https://archives.bulbagarden.net/media/upload/2/24/Spr_2c_054.png" />
			
			<h1 class="article-title" property="headline">El DDNS de Cloudflare</h1>
			
			<hr class="article-title-bottom">
			<ul class="article-meta">
				<li class="article-meta-date"><time property="datePublished">2023-06-10</time></li>
				<li class="article-meta-tags">
					<a href="/tags/ddns/">
						<b>#</b>DDNS
					</a> 
				</li>
				<li class="article-meta-tags">
					<a href="/tags/dns/">
						<b>#</b>DNS
					</a> 
				</li>
				<li class="article-meta-tags">
					<a href="/tags/cloudflare/">
						<b>#</b>Cloudflare
					</a> 
				</li>
				<li class="article-meta-tags">
					<a href="/tags/bash/">
						<b>#</b>Bash
					</a> 
				</li>
				<div class="twitter">
	<a href="https://twitter.com/intent/tweet?text=El%20DDNS%20de%20Cloudflare%20-%20Lunatic%20Geek&url=https%3a%2f%2flunaticgeek.com%2fddns%2f" target="_blank">
		<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg> Tweet
	</a>
</div>
			</ul>
			
			<center><img src="https://archives.bulbagarden.net/media/upload/2/24/Spr_2c_054.png" alt="psyduck sprite"/></center>
<p>Llevo reivindicando la creación de un servidor DDNS público por parte de Cloudflare desde hace más de cinco años, pero ese escenario me parece cada vez más improbable. Para ellos no sería más que un <em>toy project</em> que asignarían a un becario, como forma de promocionar su negocio serverless.</p>
<p>Por mi parte, estoy muy contento con el servidor que ofrece <a href="https://www.duckdns.org/">duckdns.org</a>. Los uso desde que empecé a montar webs, y es el que recomiendo a todo el mundo. Sin embargo, me he animado a dar el paso y migrar el DDNS a la plataforma de Cloudflare, a pesar de que no existe tal cosa. Paradójicamente, Cloudflare expone una completa y perfectamente estructurada <a href="https://developers.cloudflare.com/api/">API</a> con la que podemos manejar los registros DNS de nuestros dominios.</p>
<p>La estrategia a seguir sería configurar un subdominio, cuyo registro <code>A</code> fuéramos actualizando mediante peticiones a la API. Luego sólo tendríamos que apuntar el <code>cname</code> del resto de subdominios al que actúa como DDNS. Las diferencias con un servicio nativo son mínimas. En vez de utilizar un hipotético <a href="/">lunaticgeek.cloudflare.com</a>, entramos a través de <a href="/">ddns.lunaticgeek.com</a>. La forma de actualizar nuestra IP pública también es ligeramente más farragosa que con un servicio nativo, pero siguiendo su <a href="https://developers.cloudflare.com/api/operations/dns-records-for-a-zone-update-dns-record/">documentación</a>, me he construido un breve script que &mdash;añadido a un cronjob&mdash; nos facilita la tarea y nos permite prescindir del servicio de un tercero. Reitero que duckdns es un DDNS fantástico, pero puede desaparecer en cualquier momento. A largo plazo, esta solución me parece la más prudente y acertada.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/usr/bin/env bash
</span><span class="cp"></span>
<span class="nv">ZONE_IDENTIFIER</span><span class="o">=</span><span class="s2">&#34;################################&#34;</span>
<span class="nv">IDENTIFIER</span><span class="o">=</span><span class="s2">&#34;################################&#34;</span>

<span class="nv">X_AUTH_EMAIL</span><span class="o">=</span><span class="s2">&#34;edkalrio@gmail.com&#34;</span>
<span class="nv">X_AUTH_KEY</span><span class="o">=</span><span class="s2">&#34;#####################################&#34;</span>
<span class="nv">PUBLIC_IP</span><span class="o">=</span><span class="k">$(</span>curl -s https://icanhazip.com/<span class="k">)</span>
<span class="nv">RECORD</span><span class="o">=</span><span class="s2">&#34;ddns.lunaticgeek.com&#34;</span>

curl --request PUT <span class="se">\
</span><span class="se"></span>	--url https://api.cloudflare.com/client/v4/zones/<span class="si">${</span><span class="nv">ZONE_IDENTIFIER</span><span class="si">}</span>/dns_records/<span class="si">${</span><span class="nv">IDENTIFIER</span><span class="si">}</span> <span class="se">\
</span><span class="se"></span>	--header <span class="s1">&#39;Content-Type: application/json&#39;</span> <span class="se">\
</span><span class="se"></span>	--header <span class="s2">&#34;X-Auth-Email: </span><span class="si">${</span><span class="nv">X_AUTH_EMAIL</span><span class="si">}</span><span class="s2">&#34;</span> <span class="se">\
</span><span class="se"></span>	--header <span class="s2">&#34;X-Auth-Key: </span><span class="si">${</span><span class="nv">X_AUTH_KEY</span><span class="si">}</span><span class="s2">&#34;</span> <span class="se">\
</span><span class="se"></span>	--data <span class="s2">&#34;{
</span><span class="s2">	\&#34;content\&#34;: \&#34;</span><span class="si">${</span><span class="nv">PUBLIC_IP</span><span class="si">}</span><span class="s2">\&#34;,
</span><span class="s2">	\&#34;name\&#34;: \&#34;</span><span class="si">${</span><span class="nv">RECORD</span><span class="si">}</span><span class="s2">\&#34;,
</span><span class="s2">	\&#34;type\&#34;: \&#34;A\&#34;
</span><span class="s2">}&#34;</span>
</code></pre></div><p>P.S. Los más avispados se habrán dado cuenta de que mi intención de ser independiente de servicios de terceros en la administración de DDNS choca con el hecho de tener que averiguar la IP pública del servidor de origen. En mi caso, he recurrido a <a href="https://icanhazip.com/">icanzip.com</a>, que sí forma parte de la infraestructura de Cloudflare, por lo que no me desvío de mi objetivo inicial, aunque pudiera parecer lo contrario.</p>

			<div property="author" typeof="Person">
				<meta property="name" content="edkalrio" />
			</div>
			<div property="publisher" typeof="Organization">
				<meta property="name" content="Lunatic Geek Blog" />
				<div property="logo" typeof="ImageObject">
					<meta property="url" content="https://lunaticgeek.com/lunaticgeek.webp" />
				</div>
			</div>
		</article>

	</div>


<div class="site-footer">
  <div class="copyright">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
      <img src="/creative-commons.svg" class="fa" alt="creative commons" />
    </a>
    RW Labs 2023</div>
  <ul class="site-footer-items">
    
    <li class="site-footer-item-rsslink">
      <a href="https://feed.lunaticgeek.com" type="application/rss+xml" target="_blank" title="RSS">
        
        <img src="/rss.svg" class="fa" alt="feed" />
      </a>
    </li>
    <li>
      <a href="http://mdoovnnifyqyl6jmgdibrsbq6tpk22npjhntsjkwvh7syrxgepxdejad.onion">
        <img src="/tor.svg" class="fa" alt="tor" />
      </a>
    </li>
  </ul>
  <div class="powerdby">
    Powered by WIT, based on <a href="https://gohugo.io/">Hugo</a> and <a href="https://github.com/taikii/whiteplain">Whiteplain</a>
  </div>
</div>



</body>
</html>
